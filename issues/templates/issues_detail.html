{% extends 'core_main.html' %}
{% load users %}
{% block title %}{{ issue.title }} ‧ 議題 #{{issue.id}}{{ block.super }}{% endblock %}
{% block content %}
<div class="row">
	<div class="large-12 columns issue-head">
		<a class="left iconize icon-back has-tip" href="{% url 'issues:list' %}" title="回到待辦事項"></a>
		<h4 class="right">議題 <strong>#{{ issue.id }}</strong></h4>
	</div>
</div>
<div class="row">
	<div class="large-10 columns issue-thread">
		<div class="issue-main">
			<img class="avatar medium" src="{{ issue.creator.email|get_avatar:'144' }}" alt="{{ issue.creator.username }}" />
			<div class="issue-meta"><a href="#">{{ issue.creator.username }}</a> 於 {{ issue.creation_time|timesince }}前建立</div>
			<h4>{{ issue.title }}</h4>
			<div class="issue-content">
				{{ issue.content|linebreaks }}
			</div>
		</div>
		{% if user.is_authenticated %}
		<form class="issue-comment" action="#" method="POST">
		{% csrf_token %}
			<div class="issue-main">
				<img class="avatar medium" src="{{ user.email|get_avatar:'144' }}" alt="{{ user.username }}" />
				<div class="row"><div class="large-12 columns">
					<textarea name="content" id="issue-content" placeholder="寫下留言" cols="30" rows="40"></textarea>
				</div></div>
			</div>
			<div class="button-row">
				<div class="right">
					<input type="submit" class="secondary radius button" name="close_issue" value="{{ issue.is_open|yesno:'結案,復議' }}" />
					<input type="submit" class="radius button" name="comment_issue" id="comment-button" value="留言" />
				</div>
			</div>
		</form>
		{% endif %}
	</div>
	<div class="large-2 columns page-side-nav">
		<div class="issue-state">{% if issue.is_open %}{% if issue.is_expired %}
			<div class="expired">已逾時</div>{% else %}
			<div class="open">待處理</div>{% endif %}{% else %}
			<div class="closed">已結案</div>{% endif %}
		</div>
		<div class="divider"></div>
		<h6>標籤</h6>
		{% for label in issue.labels.all %}
		<div class="issue-labels">
			<div class="radius label" style="background: #{{ label.color }};">{{ label.name }}</div>
		</div>
		{% endfor %}
	</div>
</div>
<script type="text/javascript">
$(document).ready(function() {
	$('#issue-content').on('focus keyup change', function() {
       $('#comment-button').prop('disabled', ($(this).val().length <= 0));
    });
})
</script>
{% endblock %}